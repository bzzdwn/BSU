\chapter[РАСШИРЕННЫЕ МЕТОДЫ МОДЕЛИРОВАНИЯ ЗАБОЛЕВАНИЙ НА ОСНОВЕ БАЗОВЫХ МОДЕЛЕЙ]{РАСШИРЕННЫЕ МЕТОДЫ МОДЕЛИРОВАНИЯ ЗАБОЛЕВАНИЙ НА ОСНОВЕ БАЗОВЫХ МОДЕЛЕЙ}\label{chap2}

В данной главе формулируются расширенные пространственные модели распространения заболеваний, основанные задаче Коши для базовой модели.

Для конкретики все дальнейшие расширенные методы моделирования заболеваний мы будем рассматривать, взяв в качестве базовой модели SEIR-модель, так как в главе 3 мы будем проводить практические эксперименты основываясь именно на данной модели. 

Классическая SEIR-модель описывается задачей Коши
Модель SEIR описывается задачей Коши
\begin{equation*}
	\begin{dcases}
		\dfrac {\d S(t)}{\d t} = - \beta \cdot I(t)\cdot S(t),\\
		\dfrac {\d E(t)}{\d t} = \beta \cdot S(t)\cdot I(t) - \sigma\cdot E(t),\\
		\dfrac{\d I(t)}{\d t} =\sigma \cdot E(t) - \gamma\cdot I(t),\\
		\dfrac{\d R(t)}{\d t} = \gamma\cdot I(t),\\
		S(0) = S_0,\ I(0) = I_0,\ E(0) = 0,\ R(0) = 0.
	\end{dcases}
\end{equation*}

В контексте данной главы эту SEIR-модель мы будем называть \textit{детерминированной}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Вероятностные популяционные модели}\label{2sec:population-models}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Общая идея построения стохастических популяционных SIR-моделей и их обобщений аналогична их детерминированным аналогам:
популяция рассматривается как совокупность групп, внутри каждой из которых
индивиды считаются неразличимыми между собой. Различие проявляется в
описании законов перехода индивидов между группами. В качестве
математического аппарата применяются системы стохастических разностных
уравнений, цепи Маркова, случайные процессы в дискретном и непрерывном
времени (процессы Гальтона–Ватсона, процессы рождения и гибели и пр.). 

В отличие от детерминированных SIR-моделей, в стохастических имитационных моделях корректно учитывается
фактор случайности. В то же время стохастические популяционные модели
сложнее для аналитического исследования по сравнению с аналогичными
детерминированными. Полноценное аналитическое исследование возможно
лишь для некоторых простых типов моделей, в общем же случае для оценки
динамики численностей групп обычно прибегают к имитационному
моделированию с помощью методов Монте–Карло. Имитационные модели на
базе SIR–моделей обладают высокой производительностью, в результате чего
они до сих пор широко применяются в программных комплексах.

Вместо детерминистского подхода, где изменения в группах $S, E, I, R$ описываются системой дифференциальных уравнений, мы переходим к вероятностной модели. Здесь мы моделируем случайные события (например, заражение, выздоровление) как процессы, происходящие с заданными вероятностями. Причем ввиду того, что случайные величины могут быть как дискретными, так и непрерывными, то у нас имеются два варианта построения вероятностных моделей: с дискретным временем и с непрерывным временем.

\subsection{Вероятностная модель с дискретным временем}
В дискретной модели состояние популяции обновляется через конечные шаги времени 
$t=0,1,2,\ldots$. Пусть $S_t, E_t, I_t, R_t$
обозначают числа восприимчивых, экспонированных, инфекционных и выздоровевших индивидов соответственно на временном шаге $t$. Общая популяция в таком случае остается постоянной:
$$N = S_t + E_t + I_t + R_t.$$

Основная цель вероятностного подхода заключается в том, чтобы сделать переходы из одной группы в другую, которые на данный момент зависят лишь от чисел $\beta, \sigma,\gamma$, случайными. То есть для описания перехода из одной группы в другую мы должны использовать аппарат случайных величин.

Итак, пусть $\Delta t$ обозначает один шаг по времени (например, это может быть 1 день). Тогда мы можем определить следующие случайные величины
\begin{enumerate}
	\item Переход $S \to E$. Вероятность того, что восприимчивый человек $S$ заразится за один временной шаг $\Delta t$, определяется как
	$$
	P_{S\to E} = 1 - \exp\left(-\beta\cdot  \frac{I}{N} \cdot \Delta t\right)
	$$
	где $\beta$ -- коэффициент передачи инфекции, $\frac{I}{N}$ -- вероятность контакта с зараженным. Тогда число восприимчивых людей, инфицированных за промежуток времени $\Delta t$ описывается случайной величиной
	$$\Delta E_t \sim \Binom(S_t, P_{S\to E}).$$
	\item Переход $E \to I$. Зараженные, но не заразные люди $E$ становятся заразными $I$ за один временной шаг $\Delta$ с вероятностью
	$$
	P_{E\to I} = 1 - \exp\left(-\sigma \cdot \Delta t\right)
	$$
	где $\sigma = \frac{1}{T_E}$ -- обратная продолжительность инкубационного периода. Тогда число людей, перешедших в активную фазу заболевания за промежуток времени
	$\Delta t$ описывается случайной величиной
	$$\Delta I_t \sim \Binom(E_t, P_{E\to I}).$$
	\item Переход $I \to R$. Инфицированные $I$ выздоравливают и переходят в группу $R$ за временной шаг $\Delta t$ с вероятностью
	$$
	P_{I\to R} = 1 - \exp\left(-\gamma \cdot \Delta t\right)
	$$
	где $\gamma$ -- это коэффициент восстановления. Тогда число людей, удаленных из популяции (вследствие выздоровления
	или гибели)
	$\Delta t$ описывается случайной величиной
	$$\Delta R_t \sim \Binom(I_t, P_{I\to R}).$$
\end{enumerate}
Тогда из исходной задачи Коши для описания детерминированной SEIR-модели мы получаем разностную задачу для описания стохастической SEIR-модели с дискретным временем
\begin{equation}
	\begin{dcases}
		S_{t+1} = S_t - \Delta E_t,\\
		E_{t+1} = E_t +\Delta E_t - \Delta I_t,\\
		I_{t+1} = I_t + \Delta I_t - \Delta R_t,\\
		R_{t+1} = R_t + \Delta R_t,
	\end{dcases}
	t = 0,1,2\ldots,
\end{equation}
где $S_0$ и $I_0$ заданы, а $E_0 = R_0 = 0$.

Очевидно, что каждая реализация данной разностной задачи будет давать различный результат, поскольку в ней фигурируют случайные величины. 
\subsection{Вероятностная модель с непрерывным временем}
В непрерывной версии модели состояние популяции описывается с помощью стохастического процесса, часто представляемого как цепь Маркова или процесс Пуассона.

Пусть $S(t), E(t), I(t), R(t)$ -- это состояния системы в момент времени $t$. Общая популяция остается постоянной
$$N = S(t) + E(t) + I(t) + R(t).$$

Зададим непрерывную модель как процесс Пуассона, задаваемый интенсивностями переходов:
\begin{enumerate}
	\item Заражение $S \to E$:
	$$\lambda_{SE} = \dfrac{\beta \cdot S(t) \cdot I(t)}{N}.$$
	\item Переход в инфекционное состояние $E \to I$:
	$$\lambda_{EI} = \sigma \cdot E(t).$$
	\item Выздоровление $I \to R$:
	$$\lambda _{IR} = \gamma \cdot I(t).$$
\end{enumerate}

С учетом введенных интенсивностей изменения численности групп за малый интервал $\Delta t$ задаются как случайные величины из распределения Пуассона
$$\Delta E \sim \Pois(\lambda_{SE} \cdot \Delta t),$$
$$\Delta I \sim \Pois(\lambda_{EI} \cdot \Delta t),$$
$$\Delta R \sim \Pois(\lambda_{IR} \cdot \Delta t).$$

В итоге, исходя из детерминированной задачи Коши, можем описать стохастическую SEIR-модель с непрерывным временем как
\begin{equation}
	\begin{cases}
		S(t+\Delta t) = S(t) - \Delta E,\\
		E(t+\Delta t) = E(t) + \Delta E - \Delta I,\\
		I(t + \Delta t) = I(t) + \Delta I - \Delta R,\\
		R(t + \Delta t) = R(t) + \Delta R.
	\end{cases}
\end{equation}
\newpage
\subsection{Сравнение вероятностных моделей с дискретным и непрерывным временем}
Сравним основные характеристики обеих рассмотренных моделей
\begin{table}[h]
	\renewcommand{\arraystretch}{1}
	\caption{Сравнение дискретной и непрерывной SEIR-моделей}
	\begin{tabular}{|p{4cm}|p{5.5cm}|p{5.5cm}|}
		\hline
		\textbf{Характеристика} & \textbf{Дискретное время} & \textbf{Непрерывное время} \\ \hline
		Обновление состояния & Состояние обновляется на каждом шаге \( t \) & Состояние меняется как процесс Пуассона \\ \hline
		События & Моделируются биномиальными распределениями & Моделируются пуассоновскими процессами \\ \hline
		Применение & Удобна для численного моделирования & Более точна для моделирования реального времени \\ \hline
		Интенсивности переходов & Вероятности событий за шаг времени & Скорости событий (интенсивности) \\ \hline
	\end{tabular}
\end{table}

\subsection{Реализация вероятностных моделей}
Программно реализовать вероятностные модели можно с помощью численных алгоритмов. Однако каждая реализация численного алгоритма будет отличаться от остальных, поскольку на каждом шаге мы генерируем случайную величину. Вследствие этого для таких моделей принято рассчитывать $K=1,2,\ldots$ реализаций, а в качестве результата брать усредненные значения с учетом доверительного интервала. 
Для каждой модели и каждой из групп $S, E, I, R$ можно рассчитать доверительные интервалы, используя:
$$
CI = \bar{X} \pm z \cdot \frac{\sigma}{\sqrt{n}}
$$
где $\bar{X}$ -- среднее значение, $\sigma$ -- стандартное отклонение, $z$ -- квантиль нормального распределения (например, $z = 1.96$ для 95\% доверительного интервала).

Таким образом, детерминированная модель дает гладкое среднее значение, не учитывая случайные колебания, а динамическая стохастическая модель позволяет учитывать случайные колебания (например, шум), что делает ее более реалистичной.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Имитационные модели с пространственной структурой}\label{2sec:dimension-models}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

В ряде задач математической эпидемиологии
возникает необходимость учёта географической и социальной неоднородности
популяции, которая не может быть описана популяционными моделями. В этом
случае применяются имитационные модели, включающие в себя
пространственные структуры. В зависимости от типа доступных
пространственных данных и решаемого класса задач, могут быть использованы
метапопуляционные модели, клеточные автоматы, сетевые модели либо модели
с привлечением географических информационных систем. В первых трёх
случаях в модели может рассматриваться не пространственная близость
индивидов популяции, а их близость в социальном отношении (социальные
связи).

\subsection{Клеточные автоматы}

Первые имитационные модели в качестве пространственной структуры
использовали \textit{клеточные автоматы}. В простейшем случае клеточный автомат —
это прямоугольная двумерная решетка, каждый узел которой в фиксированный
момент времени находится в одном из конечного числа состояний (к примеру,
для SIR–модели узел представляет собой индивида в состоянии
«восприимчивый», «инфицированный» или «переболевший»). Как правило,
индивиды полностью отождествляются с узлом, который они занимают. В
случае, если индивиды перемещаются по сетке, полученную модель правильнее
относить к более общему классу — классу сетевых моделей, о котором речь
пойдкт далее.

В клеточном автомате принимается некоторая схема соседства, согласно
которой определяются узлы, смежные с данным — его «соседи» — четыре
соседа, восемь соседей или, при более сложных схемах соседства,
произвольное число. Иногда для имитации «дальних» контактов (к примеру,
случайных встреч незнакомых людей в общественных местах) считается, что в
каждый фиксированный момент времени помимо узлов, смежных с данным в
пространственной решетке, соседями рассматриваемого узла являются
несколько произвольно выбранных во всей решетке узлов.

Время в клеточных автоматах дискретное, на каждом шаге все состояния
узлов решетки меняются в соответствии с выбранным правилом перехода,
являющимся функцией от состояний соседей фиксированного узла. Если
правило перехода детерминированное (например, если больше половины
соседей индивида инфицированы, то он тоже становится инфицированным), то
клеточный автомат называется детерминированным. Если же это правило
имеет вероятностный характер (например, индивид, имеющий хотя бы одного инфицированного соседа, становится инфицированным с вероятностью p), то
автомат называется вероятностным (стохастическим).

Поскольку подход с использованием клеточных автоматов является
достаточно общим, соответствующие имитационные модели могут
применяться для решения большого круга задач математической
эпидемиологии. 

\subsection{Сетевые модели}

Более гибким способом моделирования пространственной неоднородности
является использование сетей. Аналогично клеточным автоматам, в
\textit{классических сетевых моделях} распространения инфекций индивиды
обозначаются узлами, при этом каждый индивид может иметь произвольное
количество связей с другими индивидами (социальных либо пространственных).
Эти связи обозначаются дугами. Различают статические сети, в которых
количество узлов и связи между ними неизменны, и динамические, в которых
они могут меняться с некоторым шагом по времени. Если узлы сети, помимо
состояния, связанного с заболеваемостью («восприимчивый»,
«инфицированный» или «переболевший»), имеют набор параметров, то сетевая
модель становится индивидуум–ориентированной.

Одним из главных плюсов простых
имитационных пространственных моделей является возможность их
использования для построения простых моделей пространственно
неоднородных популяций, не требующих большого количества входных
данных. Минусом является недостаточная реалистичность моделирования
пространственных отношений из–за применения регулярной пространственной
структуры.

Достоинством сетевых моделей является их гибкость, позволяющая
наиболее полно отражать все аспекты распространения заболеваний, связанные
с пространственной неоднородностью популяции. В частности, в отличие от
клеточных автоматов, они позволяют моделировать такие важные явления, как
кластеризацию популяции (наличие групп с высокой связностью узлов друг с
другом), «суперраспространителей» (индивидов, имеющих наибольшее
количество связей, заражение которых влечёт быстрое распространение
инфекции) и пр. В связи с этим с помощью сетевых моделей возможно
изучение некоторых нетривиальных режимов распространения эпидемий, не
воспроизводимых популяционными моделями и клеточными автоматами.
Минусом является повышение сложности модели, что требует дополнительных
данных для проведения вычислительных экспериментов.

\subsection{Постановка задачи для пространственной модели}

Рассмотрим вероятностную модель распространения инфекции, но добавим учет пространственной неоднородности. Пространственная неоднородность важна, так как инфекция распространяется неравномерно: люди имеют ограниченные социальные контакты, живут в разных регионах и перемещаются. Мы рассмотрим модель на основе клеточных автоматов, чтобы учесть пространственную структуру популяции.

Клеточные автоматы -- это удобный инструмент для моделирования пространственных процессов, таких как распространение инфекции. В такой модели

\begin{itemize}
	\item пространство делится на дискретные ячейки (регион, квартал, город и т.д.);
	\item каждая ячейка имеет состояние (например, $S$, $E$, $I$, $R$);
	\item состояние каждой ячейки обновляется во времени в зависимости от её текущего состояния и состояния соседей.
\end{itemize}

Клеточные автоматы хорошо подходят для моделирования локальных взаимодействий и пространственного распространения инфекции.

Пусть пространство задается как двумерная сетка размера $M\times N$, где каждая ячейка представляет некоторую область (например, это может быть город или район).
Каждая из ячеек имеет одно из состояний:
\begin{itemize}
	\item $S$ -- восприимчивые;
	\item $E$ -- инфицированные в инкубационном периоде;
	\item $I$ -- заразные;
	\item $R$ -- выздоровевшие.
\end{itemize}
В каждой ячейке инфекция распространяется с некоторой вероятностью, зависящей от
\begin{itemize}
	\item численности зараженных в текущей ячейке;
	\item численности зараженных в соседних ячейках.
\end{itemize}
Опишем механику всего процесса.
Восприимчивые $S$ могут заразиться от инфицированных $I$ в той же ячейке или в соседних ячейках. Вероятность заражения зависит от коэффициента передачи $\beta$ и числа зараженных.
Как и в модели SEIR, индивиды переходят между состояниями $E, I, R$ с вероятностями, зависящими от параметров $\sigma$ (инкубационный период) и $\gamma$ (выздоровление).
Однако в отличие от детерминированной SEIR-модели, соседние ячейки могут влиять друг на друга. Например, если в одной ячейке много зараженных, соседние ячейки получают дополнительный риск заражения.

\subsection{Реализация пространственной модели}

Опишем алгоритм реализации пространственной модели.
Сперва, исходя из постановки пространственной задачи, необходимо создать двумерную сетку $M\times N$, где каждая ячейка содержит численности $S,E,I,R$. Далее на каждом временном шаге:
\begin{itemize}
	\item для каждой ячейки рассчитывается вероятность заражения с учетом соседей;
	\item обновляются состояния ячеек (заражение, выздоровление, переходы между состояниями).
\end{itemize}
Для остановки цикла необходимо задать верхнюю границу для времени, то есть период времени, в течение которого моделируется эпидемия.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Индивидуум-ориентированные и мультиагентные методы моделирования}\label{2sec:multiagent-models}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

В рамках индивидуум-ориентированного подхода каждый
индивид наделяется набором параметров, описывающих его внутренние
особенности, пространственное расположение, социальный статус и показатели,
связанные с протеканием заболевания. Часто индивидуум–ориентированные
модели строятся на основе пространственных структур, но в общем случае они
могут и отсутствовать.

Среди индивидуум-ориентированных моделей выделяется подкласс,
включающий в себя так называемые мультиагентные модели. Принадлежность
индивидуум–ориентированной модели к классу мультиагентных, как правило,
определяется тем, что индивиды в них моделируются как независимые сущности с определённым шаблоном поведения. В результате действий
отдельных агентов, направленных на достижение индивидуальных целей, у
системы наблюдаются некоторые свойства, не присущие её отдельным
элементам.

Следует отметить, что в ряде работ модели называются «индивидуум–
ориентированными» или даже «мультиагентными» в случае, если в моделях
происходит обращение к индивидам как к отдельным сущностям (в отличие от
классических популяционных моделей, которые манипулируют численностями
групп индивидов), при этом сами индивиды могут быть не отличимыми друг от
друга.

Бесспорным достоинством индивидуум-ориентированного подхода является возможность сколь угодно детального
описания свойств индивидов, влияющих на распространение болезни в
популяции. Благодаря этому индивидуум-ориентированные модели позволяют
задавать процессы в неоднородных популяциях с наиболее высокой степенью
достоверности. Вместе с тем, многопараметрическое описание индивидов
приводит к необходимости в детальных данных для калибровки моделей и
значительных вычислительных ресурсах для проведения экспериментов. Кроме
того, переусложненные модели неудобны в обращении и результаты их работы
сложно интерпретировать. По этим причинам важно найти удачный
компромисс между реалистичностью разрабатываемых моделей и их
наглядностью.

\subsection{Постановка задачи для мультиагентной модели}
В модели, построенной на основе клеточных автоматов, используется решетка, где каждая ячейка представляет собой часть популяции. Однако в реальности индивиды имеют различные характеристики, например
\begin{itemize}
	\item индивидуальная восприимчивость, то есть люди имеют разный иммунитет, что влияет на вероятность заражения;
	\item различные периоды инкубации и выздоровления, то есть у разных индивидов инкубационный и инфекционный периоды могут варьироваться;
	\item индивидуальные контакты, то есть люди взаимодействуют с разным числом других людей, что влияет на передачу болезни;
	\item мобильность, то есть люди перемещаются в пространстве (не фиксированы в одной ячейке).
\end{itemize}

Учет этих факторов может значительно повысить точность модели, так как она будет учитывать вариативность в поведении и характеристиках индивидов.

\subsection{Реализация мультиагентной модели}

Предлагается перейти от клеточной решетки к мультиагентной модели, где каждый человек является отдельным агентом. Основные параметры этого агента могут быть следующими
\begin{itemize}
	\item state: состояние (S, E, I, R);
	\item position: координаты агента в пространстве;
	\item contact\_rate: число контактов в единицу времени;
	\item susceptibility: индивидуальная восприимчивость;
	\item ncubation\_period: индивидуальный инкубационный период;
	\item infectious\_period: индивидуальный инфекционный период.
\end{itemize}

Опишем механику всего процесса. В каждый временной шаг агенты перемещаются случайным образом. Если два агента находятся близко друг к другу, они могут вступить в контакт (с вероятностью, зависящей от их contact\_rate).
При контакте зараженный агент может передать инфекцию восприимчивому индивиду с вероятностью, зависящей от их susceptibility и состояния.

Индивидуум-ориентированная модель требует значительно больше вычислительных ресурсов, чем решетчатая, так как
\begin{itemize}
	\item каждый агент имеет уникальные параметры, что увеличивает объем вычислений;
	\item проверка контактов между агентами требует временной сложности $O(N^2)$ для каждой итерации;
	\item необходимо больше времени для калибровки параметров ($\sigma, \gamma, \beta$).
\end{itemize}

Однако мультиагентный подход позволяет учитывать вариативность, что делает его более точным для моделирования реальных эпидемий.

Таким образом, мультиагентный подход целесообразен, если необходимо учитывать индивидуальные особенности и географические перемещения. Для моделей с большим числом агентов (более 10,000) можно использовать оптимизации, такие как пространственные деревья или GPU-вычисления. Если цель -- это быстрое моделирование крупных популяций, то решетчатая модель остается предпочтительной.